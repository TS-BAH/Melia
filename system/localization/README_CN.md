# Melia 本地化指南

Melia 采用类似 **"gettext"** 的本地化系统，通过读取 `.po` 翻译文件实现多语言支持。本指南将介绍如何创建和维护本地化文件。

---

## 核心机制
- **翻译文件路径**：配置文件 `localization.conf` 指定使用的 `.po` 文件（默认位于 `user/localization/`）
- **优先级规则**：若某条目未翻译，则回退显示原始英文文本
- **动态更新**：支持在开发过程中实时添加/修改翻译条目

## 使用 Poedit 创建翻译

### 准备工作
1. 下载安装 [Poedit](http://poedit.net/)（免费开源工具）
2. 在 Melia 根目录创建 `user/localization/` 文件夹

### 新建翻译文件
1. **创建文件**  
   `文件 > 新建` → 选择目标语言 → 保存为 `user/localization/[语言代码].po`（如 `zh-CN.po`）

2. **配置项目**  
   - **基础路径**：选择 Melia 根目录
   - **包含路径**：添加 `src` 和 `system` 文件夹
   - **字符编码**：选择 `UTF-8`

3. **设置关键词**  
   在 *源关键词* 中添加以下条目（不加引号）：
   ```
   Localization.Get:1
   Localization.GetPlural:1,2
   Localization.GetParticular:1c,2
   Localization.GetParticularPlural:1c,2,3
   L:1
   LN:1,2
   LX:1c,2
   LXN:1c,2,3
   ```
   *注：`Localization.Get...` 用于核心代码，其他方法用于脚本*

4. **提取文本**  
   点击 *确定* 开始扫描可翻译文本 → 完成扫描后进入翻译界面

### 翻译与维护
- **翻译条目**：选中原文 → 在下方输入翻译内容
- **更新词库**：`目录 > 从源代码更新` 可同步新增文本
- **覆盖默认英文**：创建 `en-US.po` 文件可修改原始英文显示

## 配置生效
1. 编辑 `localization.conf`：  
   ```text
   language = "zh-CN"  // 与.po文件名一致
   ```
2. 重启 Melia 服务使配置生效

---

## 最佳实践
- **版本控制**：将 `.po` 文件纳入版本管理，方便团队协作
- **术语统一**：使用 `Poedit > 编辑 > 术语表` 维护专用术语
- **模糊匹配**：善用 `建议翻译` 功能加速批量翻译
- **测试验证**：修改后通过游戏内 NPC 对话/UI 元素验证显示效果

---
**疑难解答**：  
- 若翻译未生效 → 检查文件名与配置是否匹配
- 出现乱码 → 确保 Poedit 和 Melia 均使用 UTF-8 编码
- 新增文本未识别 → 执行「从源代码更新」操作