# 贡献指南

## 提交问题
=============================================================================

在提交问题前，请使用搜索功能查看是否已有类似问题存在。

### 错误报告
-----------------------------------------------------------------------------
若在 Melia 中发现错误，请单独创建问题报告，详细描述触发场景与复现步骤。必要时可附截图或视频说明。

请注意：Melia 仍处于早期开发阶段，某些功能未实现可能并非错误，而是尚未开发完成。

### 功能建议
-----------------------------------------------------------------------------
我们欢迎对服务器模拟器的改进建议，请通过问题模板提交。但请注意，我们的核心目标是模拟原版游戏，与游戏主体无关的自定义功能（如独立NPC设计）可能超出当前开发范围。

### 技术讨论
-----------------------------------------------------------------------------
若您正在开发某个功能并希望征求意见，或需要讨论实现方案，请创建专门的问题进行集中讨论。

众人拾柴火焰高，协作开发将使 Melia 更臻完善。

## 代码贡献
=============================================================================

我们接受通过 **拉取请求（PR）** 提交的代码贡献，包括新功能、错误修复或优化调整。为确保评审流程高效顺畅，请遵循以下准则：

- **原子化提交**：每个 PR 应专注解决单一问题（例如：一个 PR 对应一个错误修复）
- **清晰的提交信息**：使用描述性语句，如"修复 XY 错误"或"新增 YZ 功能"
- **说明文档**：在 PR 描述中简要说明修改内容
- **基准分支**：基于最新的 `master` 分支进行开发
- **代码规范**：遵循下文编码规范
- **重大变更预讨论**：涉及核心架构调整的功能，请先在问题区讨论方案

### 编码规范
-----------------------------------------------------------------------------
#### C# 规范
- **基础标准**：
  - [微软命名规范](http://msdn.microsoft.com/en-us/library/xzf533w0%28v=vs.71%29.aspx)
  - [微软 C# 编码约定](http://msdn.microsoft.com/en-us/library/ff926074.aspx)
- **特殊约定**：
  - 私有字段使用 `_camelCase` 命名法
  - 属性、公共字段和方法使用 `this.PascalCase` 命名法
  - 使用制表符（Tab）缩进
  - 注释行建议不超过 80 字符
  - 推荐使用自动格式化工具（如 [保存时自动格式化](https://marketplace.visualstudio.com/items?itemName=mynkow.FormatdocumentonSave)）
  - 慎用 `#region` 代码区域
  - 注释后应添加空格（例：`// 注释内容`）
  - 属性存取器应保持简单，避免复杂运算或数据包操作
  - 优先使用属性而非纯取值方法
  - 合理使用 `var` 隐式类型声明
  - 使用 `using` 指令简化命名空间引用（例：优先使用 `Console.WriteLine` 而非 `System.Console.WriteLine`）
  - 文件名避免使用前缀（如接口文件无需添加"I"前缀）

推荐使用支持 EditorConfig 的 IDE（如 VS2017+），可自动适配编码规范。

#### JSON 规范
- 基础结构为最外层数组包含对象
- 键名使用 `camelCase` 命名且不加引号
- 值应使用原生类型（例如布尔值而非"YES"/"NO"字符串）
- 行尾避免添加注释
- 注释应分类说明，详细解释应置于文件头部
- 注释后添加空格（例：`// 注释内容`）

#### Lua 规范
- 使用制表符缩进
- 变量函数使用连贯命名（例：`somefunction`），必要时可用下划线分隔（例：`npchandler_角色名`）
- 常量使用全大写加下划线（例：`SOME_CONSTANT`）
- 优先使用局部变量
- 注释后添加空格（例：`-- 注释内容`）

#### 二进制模板规范
- 使用制表符缩进
- 结构体和枚举使用 PascalCase 命名
- 变量、字段和函数使用 camelCase 命名
- 必要时可使用 UPPER_SNAKE_CASE 命名官方结构体（例：`APPEARANCE_PC`）
- 注释后添加空格（例：`// 注释内容`）
- 模板头部需注明适用版本及变更历史

### 分支策略
-----------------------------------------------------------------------------
- **`master` 分支**：稳定分支，始终保持可编译运行状态，不含调试代码
- **功能分支**：超过 10 行代码的修改应创建独立分支，命名格式为：
  - 功能开发：`feature/问题号-功能名`（例：`feature/2447-foobar`）
  - 错误修复：`fix/问题号-问题描述`（例：`fix/1029-skill-bug`）
- 功能开发完成后，通过 PR 提交评审并合并至 `master`

### 协作流程
-----------------------------------------------------------------------------
推荐采用以下工作流：

1. Fork 主仓库到个人账号
2. 添加主仓库为远程源
3. 定期同步主仓库 `master` 分支到本地
4. 禁止直接向 Fork 仓库的 `master` 分支推送代码
5. 遵循相同分支策略创建开发分支
6. 开发完成后向主仓库发起 PR

该流程可保持代码库整洁，便于同步更新和版本管理。您也可根据实际需求调整，但请确保遵循核心规范。

---
**备注**：本指南旨在建立高效协作机制，具体实施细节可根据实际情况灵活调整。